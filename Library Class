import java.util.Scanner;

/**
 * Write a description of class Library here.
 * 
 * @author (your name) 
 * @version (a version number or a date)
 */
public class Library
{
    Scanner userInput = new Scanner(System.in);

    private Book[] bookCollection;
    private int collectionSize;
    private String address;
    private String openingHours;

    //put array of objects as argument to method. this.arrayElement(Object) = objectField. 
    //for (class object : x) { object.getBook() if(getName() = x)) { execute x } )}

    // Constructor for objects of class Library
    public Library(String adr)
    {
        address = adr;
        bookCollection = new Book[500];
        collectionSize = 0;
        openingHours = " 9:00 - 21:00 "; //all libraries have the same hours
    }

    // Add a book to the library collection
    public void addBook(Book book)
    {
        bookCollection[collectionSize] = book;
        this.collectionSize++;
    }

    public void searchBook(String userString) { //case sensitive. must change.
        int resultCounter = 0;
        System.out.printf("\fBooks that match the inserted Keyword '%s'\n", userString);

        for (int i=0; i<collectionSize; i++) {
            if ((bookCollection[i].getAuthor().contains(userString)) || (bookCollection[i].getTitle().contains(userString)))
            {
                System.out.printf("Title: %s, Author: %s, Barcode: %s, Shelf-number: %s Available: %s\n", bookCollection[i].getTitle(), 
                    bookCollection[i].getAuthor(), bookCollection[i].getBarcode(), bookCollection[i].getShelfNumber(), bookCollection[i].isAvailable());
                resultCounter++;
            } 
        }

        if (resultCounter < 1) {
            System.out.printf("None.");
        }
    }

    public void searchByBarcode(String userString) { //to finish.
        int resultCounter = 0;
        System.out.printf("\fBooks that match the inserted barcode '%s'\n", userString);

        for (int i=0; i<collectionSize; i++) {
            if (bookCollection[i].getBarcode().contains(userString)) 
            {
                System.out.printf("Title: %s, Author: %s, Barcode: %s, Shelf-number: %s Available: %s\n", bookCollection[i].getTitle(), 
                    bookCollection[i].getAuthor(), bookCollection[i].getBarcode(), bookCollection[i].getShelfNumber(), bookCollection[i].isAvailable());
                resultCounter++;
            } 
        }

        if (resultCounter < 1) {
            System.out.printf("None.");
        }
    }

    public void searchByTitle(String userString) {
        int resultCounter = 0;
        System.out.printf("\fBooks that match the inserted title '%s'\n", userString);

        for (int i=0; i<collectionSize; i++) {
            if (bookCollection[i].getTitle().contains(userString)) 
            {
                System.out.printf("Title: %s, Author: %s, Barcode: %s, Shelf-number: %s Available: %s\n", bookCollection[i].getTitle(), 
                    bookCollection[i].getAuthor(), bookCollection[i].getBarcode(), bookCollection[i].getShelfNumber(), bookCollection[i].isAvailable());
                resultCounter++;
            } 
        }

        if (resultCounter < 1) {
            System.out.printf("None.");
        }
    }

    public void searchByAuthor (String userString) {
        int resultCounter = 0;
        System.out.printf("\fBooks that match the inserted author '%s'\n", userString);

        for (int i=0; i<collectionSize; i++) {
            if (bookCollection[i].getAuthor().contains(userString)) 
            {
                System.out.printf("Title: %s, Author: %s, Barcode: %s, Shelf-number: %s Available: %s\n", bookCollection[i].getTitle(), 
                    bookCollection[i].getAuthor(), bookCollection[i].getBarcode(), bookCollection[i].getShelfNumber(), bookCollection[i].isAvailable());
                resultCounter++;
            } 
        }

        if (resultCounter < 1) {
            System.out.printf("None.");
        }
    }

    public void searchByShelfNumber (String userString) {
        int resultCounter = 0;
        System.out.printf("\fBooks that match the inserted shelf number '%s'\n", userString);

        for (int i=0; i<collectionSize; i++) {
            if (bookCollection[i].getShelfNumber().contains(userString)) 
            {
                System.out.printf("Title: %s, Author: %s, Barcode: %s, Shelf-number: %s Available: %s\n", bookCollection[i].getTitle(), 
                    bookCollection[i].getAuthor(), bookCollection[i].getBarcode(), bookCollection[i].getShelfNumber(), bookCollection[i].isAvailable());
                resultCounter++;
            } 
        }

        if (resultCounter < 1) {
            System.out.printf("None.");
        }
    }

    public void borrowBook(String userStringParam) {
        boolean barcodeExists = false;

        for (int i=0; i<collectionSize; i++) {
            if (bookCollection[i].getBarcode().equals(userStringParam.trim())) {
                if (bookCollection[i].isAvailable() == true) {
                    bookCollection[i].borrowBook();
                    System.out.print("\fBook borrowed successfully.");
                    barcodeExists = true;
                    break;
                } else {
                    System.out.print("\fSorry, this book is currently unavailable.");
                    barcodeExists = true;
                }
            } 
        } 

        if(barcodeExists == false) {
            System.out.print("\fAre you sure you are inserting the right barcode?");
        } 
    }

    public void returnBook(String userStringParam) {
        boolean barcodeExists = false;

        for (int i=0; i<collectionSize; i++) {
            if (bookCollection[i].getBarcode().equals(userStringParam.trim())) {
                if (bookCollection[i].isAvailable() == false) {
                    bookCollection[i].returnBook();
                    System.out.print("\fBook returned successfully.");
                    barcodeExists = true;
                    break;
                } else {
                    System.out.print("\fThis book is not on loan.");
                    barcodeExists = true;
                }
            } 
        } 

        if(barcodeExists == false) {
            System.out.print("\fAre you sure you are inserting the right barcode?");
        } 
    }

    public void removeBook(String userStringParam) { //can have index out of bounds if [500]
        boolean barcodeExists = false;

        for (int i=0; i<collectionSize; i++) {
            if (bookCollection[i].getBarcode().equals(userStringParam.trim())) {
                for (int j = (i + 1); j<collectionSize; j++) {
                    bookCollection[j-1] = bookCollection[j]; 
                }
                System.out.print("Book deleted successfully!\n");
                collectionSize--;
                barcodeExists = true;
                break;
            } 
        } 

        if(barcodeExists == false) {
            System.out.print("\fAre you sure you are inserting the right barcode?");
        } 
    }

    public void showAll() {
        System.out.print("\fList of all books (including available and non-available)\n");
        for (int i =0; i<collectionSize; i++) {
            System.out.printf("Title: %s, Author: %s, Barcode: %s, Shelf-number: %s Available: %s\n", bookCollection[i].getTitle(), bookCollection[i].getAuthor(), bookCollection[i].getBarcode(), bookCollection[i].getShelfNumber(), bookCollection[i].isAvailable());
        }
    }

    public void showAvailable() {
        System.out.print("\fList of available books\n");

        for (int i=0; i<collectionSize; i++) {
            if (bookCollection[i].isAvailable()) {
                System.out.printf("Title: %s, Author: %s, Barcode: %s, Shelf-number: %s\n", bookCollection[i].getTitle(), bookCollection[i].getAuthor(), bookCollection[i].getBarcode(), bookCollection[i].getShelfNumber());
            }
        }
    }

    public void printAuthors() {
        System.out.print("\fList of author names: \n");
        for (int i=0; i<collectionSize; i++) {
            System.out.printf("%s\n", bookCollection[i].getAuthor() );
        }
    }

    public void distinct(String[] my_arr){
        for (int i = 0; i < my_arr.length; i++){
            int j;
            for (j = 0; j < i; j++)
                if (my_arr[i].equals(my_arr[j]))
                    break;
            if (i == j)
                System.out.print(my_arr[i] + "\n ");
        }
    }

    public void printDistinctAuthors() { //to do
        System.out.print("\fList of (distinct) author names: \n");
        String[] arrayDistinctAuthors = new String[collectionSize];

        for (int i = 0; i < collectionSize; i++) {
            arrayDistinctAuthors[i] = bookCollection[i].getAuthor();
        }
        distinct(arrayDistinctAuthors); 
        //either create temp array for authors and check if name already there or do sort algorithm to check if contiguous elements in the array are the same. 
    }

    public void printLibraryDetails() {
        System.out.printf("\fDetails of first library\nAddress: %s, Opening times: %s", this.address, this.openingHours);
    }

    public void changeBookDetails(String barcode) {
        boolean barcodeExists = false;

        for (int i = 0; i < collectionSize; i++) {
            if (bookCollection[i].getBarcode().equals(barcode.trim())) {
                barcodeExists = true;

                while (true) {
                    System.out.print("\nSelect detail to change:\n");
                    System.out.print("1-Title\n2-Author\n3-Pages\n4-Shelf Number\n5-Barcode\n6-Exit\n\nChoice: ");

                    int choice = userInput.nextInt();
                    userInput.nextLine();

                    switch(choice) {
                        case 1:
                            System.out.print("Enter new title: ");
                            String newTitle = userInput.nextLine();
                            bookCollection[i] = new Book(
                                bookCollection[i].getAuthor(), 
                                newTitle, 
                                bookCollection[i].getPages(), 
                                bookCollection[i].getShelfNumber(), 
                                bookCollection[i].getBarcode()
                            );
                            System.out.println("Title updated successfully!");
                            break;
                            
                        case 2:
                            System.out.print("Enter new author: ");
                            String newAuthor = userInput.nextLine();
                            bookCollection[i] = new Book(
                                newAuthor, 
                                bookCollection[i].getTitle(), 
                                bookCollection[i].getPages(), 
                                bookCollection[i].getShelfNumber(), 
                                bookCollection[i].getBarcode()
                            );
                            System.out.println("Author updated successfully!");
                            break;

                        case 3:
                            System.out.print("Enter new number of pages: ");
                            String newPages = userInput.nextLine();
                            bookCollection[i] = new Book(
                                bookCollection[i].getAuthor(), 
                                bookCollection[i].getTitle(), 
                                newPages, 
                                bookCollection[i].getShelfNumber(), 
                                bookCollection[i].getBarcode()
                            );
                            System.out.println("Pages updated successfully!");
                            break;

                        case 4:
                            System.out.print("Enter new shelf number: ");
                            String newShelfNumber = userInput.nextLine();
                            bookCollection[i] = new Book(
                                bookCollection[i].getAuthor(), 
                                bookCollection[i].getTitle(), 
                                bookCollection[i].getPages(), 
                                newShelfNumber, 
                                bookCollection[i].getBarcode()
                            );
                            System.out.println("Shelf number updated successfully!");
                            break;

                        case 5:
                            System.out.print("Enter new barcode: ");
                            String newBarcode = userInput.nextLine();
                            bookCollection[i] = new Book(
                                bookCollection[i].getAuthor(), 
                                bookCollection[i].getTitle(), 
                                bookCollection[i].getPages(), 
                                bookCollection[i].getShelfNumber(), 
                                newBarcode
                            );
                            System.out.println("Barcode updated successfully!");
                            break;

                        case 6:
                            return;

                        default:
                            System.out.println("Invalid choice. Please try again.");
                    }
                }
            }
        }

        if (!barcodeExists) {
            System.out.println("Book with barcode " + barcode + " not found.");
        }
    }

}
